# SMC Quantitative Backtester

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑ –Ω–∞ –±–∞–∑–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ **Smart Money Concepts (SMC)**. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–æ–¥–∏—Ç –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö Binance, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç `Confluence Score` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ç–∞–ø–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å.

## üß† –õ–æ–≥–∏—á–µ—Å–∫–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Äî —ç—Ç–æ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –°—Ö–µ–º–∞ –Ω–∏–∂–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ `BacktestEngine`:

```text
[ Data Layer ]            [ Analytical Layer ]             [ Execution Layer ]
+-------------+          +--------------------+          +-------------------+
| Binance API |--------->|    SMC Analyzer    |--------->|   Strategy Core   |
| (Klines)    |  DataFrame  | (Pivots/BOS/OB/FVG) |  Context   | (Risk & Decision) |
+-------------+          +----------+---------+          +---------+---------+
                                    |                              |
                                    v                              v
                           +------------------+           +------------------+
                           | Confluence Score |---------->|  Trade Manager   |
                           | (Weight Calculation) |  Signal    | (PnL/Slippage)   |
                           +------------------+           +------------------+
                                                                   |
                                                                   v
                                                          +------------------+
                                                          | Result Artifacts |
                                                          | (JSON/PNG/Logs)  |
                                                          +------------------+
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫

*   **Core**: Python 3.10+ (Type Hinting, Dataclasses).
*   **Data Processing**: Pandas & NumPy (–≤–µ–∫—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç ATR, —Å–∫–æ–ª—å–∑—è—â–∏—Ö).
*   **Market Analysis**: –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è SMC (–∞–ª–≥–æ—Ä–∏—Ç–º—ã LuxAlgo –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥ Python).
*   **Visualization**: Matplotlib + Seaborn (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤).
*   **Network**: `requests` —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π Rate Limits –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–µ—Å—Å–∏–π.

## üìê –ê–ª–≥–æ—Ä–∏—Ç–º "Confluence Score"

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, —Ç–≤–æ–π –±–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∑–≤–µ—à–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Ñ–∞–∫—Ç–æ—Ä–æ–≤. –°—Ö–µ–º–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è:

```text
      [ –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï –°–í–ï–ß–ò ]
                |
                v
  +---------------------------+
  | 1. –ê–Ω–∞–ª–∏–∑ –°—Ç—Ä—É–∫—Ç—É—Ä—ã       | -> (Swing Bias: BULLISH/BEARISH)
  +---------------------------+
                |
  +---------------------------+
  | 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ó–æ–Ω (POI)    |
  | - Order Blocks (Active?)  | -> (+ –í–µ—Å –∑–∞ –∫–∞—Å–∞–Ω–∏–µ OB)
  | - FVG (Unfilled?)         | -> (+ –í–µ—Å –∑–∞ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –∏–º–±–∞–ª–∞–Ω—Å–∞)
  | - Liquidity (Swept?)      | -> (+/- –í–µ—Å –∑–∞ —Å–Ω—è—Ç–∏–µ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)
  +---------------------------+
                |
  +---------------------------+
  | 3. –ú—É–ª—å—Ç–∏-—Ç–∞–π–º—Ñ—Ä–µ–π–º       | -> (+ –í–µ—Å –µ—Å–ª–∏ D1/W1 —Å–æ–≤–ø–∞–¥–∞—é—Ç)
  +---------------------------+
                |
                v
    [ –ò–¢–û–ì–û–í–´–ô SCORE (-1..1) ]
                |
    (–ï—Å–ª–∏ Score > 0.35 –∏–ª–∏ < -0.35)
                |
                v
       [ –†–ò–°–ö-–ú–ï–ù–ï–î–ñ–ú–ï–ù–¢ ]
   (–†–∞—Å—á–µ—Ç –ª–æ—Ç–∞ –æ—Ç ATR –∏ SL)
                |
                v
        [ ENTRY / SKIP ]
```

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ú–æ–¥—É–ª–∏

1.  **SmartMoneyConceptsAnalyzer**:
    *   –î–µ—Ç–µ–∫—Ü–∏—è **Swing High/Low** —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —à—É–º–∞.
    *   –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–º–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (**BOS / CHoCH**) —Å —É—á–µ—Ç–æ–º ATR.
    *   –ü–æ–∏—Å–∫ **Order Blocks** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –º–∏—Ç–∏–≥–∞—Ü–∏–∏ (Mitigation).
    *   –†–∞—Å—á–µ—Ç –∑–æ–Ω **Premium / Discount / Equilibrium**.

2.  **Trade Simulator (Execution)**:
    *   –≠–º—É–ª—è—Ü–∏—è **–ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è** (Slippage Model: Volume Based).
    *   –£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π (Maker/Taker) –∏ —Ñ–∞–Ω–¥–∏–Ω–≥–∞ (Funding Rate).
    *   –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SL/TP –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (ATR Multiplier).

3.  **Reporting Engine**:
    *   –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Equity Curve –∏ Drawdown Chart.
    *   –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ Win Rate –ø–æ –º–µ—Å—è—Ü–∞–º.
    *   –ê–Ω–∞–ª–∏–∑ R:R (Risk/Reward) ‚Äî –æ–∂–∏–¥–∞–µ–º—ã–π vs —Ä–µ–∞–ª—å–Ω—ã–π.

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`config_smc.json`)

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:

| –ì—Ä—É–ø–ø–∞ | –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **Logic** | `lookback` | –ì–ª—É–±–∏–Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–∏–≤–æ—Ç–æ–≤. |
| **Analysis** | `ob_mitigation` | –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ OB (`HIGHLOW` –∏–ª–∏ `CLOSE`). |
| **Filters** | `internal_confluence` | –í–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –±–∞—Ä–æ–≤. |
| **Risk** | `risk_per_trade` | % —Ä–∏—Å–∫–∞ –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–∞ –Ω–∞ —Å–¥–µ–ª–∫—É (def: 0.015). |
| **Execution** | `slippage_model` | –ú–æ–¥–µ–ª—å –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è (`volume_based`). |

## üìä –ü—Ä–∏–º–µ—Ä –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (Artifacts)

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –≤ –ø–∞–ø–∫–µ `backtests/` —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```text
backtests/
‚îî‚îÄ‚îÄ enhanced_SOLUSDT_1h_20231025/
    ‚îú‚îÄ‚îÄ results.json           # –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ JSON
    ‚îú‚îÄ‚îÄ detailed_report.txt    # –ß–∏—Ç–∞–±–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
    ‚îú‚îÄ‚îÄ trades_summary.csv     # –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ –¥–ª—è Excel
    ‚îú‚îÄ‚îÄ chart_main.png         # –ì—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω—ã —Å –º–µ—Ç–∫–∞–º–∏ –≤—Ö–æ–¥–æ–≤
    ‚îî‚îÄ‚îÄ chart_performance.png  # –î–∞—à–±–æ—Ä–¥ (Equity, Drawdown, Stats)
```

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ config_smc.json)

# 3. –ó–∞–ø—É—Å–∫ –¥–≤–∏–∂–∫–∞
python main.py
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É (Binance API) –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–≤–µ—á–µ–π.
